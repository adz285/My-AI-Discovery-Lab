<!-- intake.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- NOTE: Google Search Console verification is via DNS (no meta tag required). -->

  <!-- ====== PAID GATE (KEEP) ====== -->
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);

      // Offer routing: default snapshot, audit requires paid
      const offer = (params.get("offer") || "snapshot").toLowerCase();

      // Allow access for testing OR Stripe success param
      const allowPreview = params.get("preview") === "1";
      const allowPaidParam = params.get("paid") === "1";

      // If coming from Stripe success, persist paid status for future visits (refresh/bookmark)
      if (allowPaidParam) {
        try { localStorage.setItem("myaidl_paid_intake", "1"); } catch (e) {}
      }

      // Snapshot uses same intake form (no paid gate)
      if (offer !== "audit") return;

      // Owner preview mode OR paid param allows access immediately
      if (allowPreview || allowPaidParam) return;

      // Paid flag persisted after Stripe success redirect
      const isPaid = localStorage.getItem("myaidl_paid_intake") === "1";

      if (!isPaid) {
        window.location.replace("/index.html");
      }
    })();
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Audit Intake — My AI Discovery Lab</title>
  <meta name="description" content="Complete the AI Discovery Audit intake form so we can begin your audit." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://myaidiscoverylab.com/intake.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="Audit Intake — My AI Discovery Lab" />
  <meta property="og:description" content="Submit your details to begin the AI Discovery Audit." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://myaidiscoverylab.com/intake.html" />
  <meta property="og:image" content="https://myaidiscoverylab.com/og-image.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Audit Intake — My AI Discovery Lab" />
  <meta name="twitter:description" content="Submit your details to begin the AI Discovery Audit." />
  <meta name="twitter:image" content="https://myaidiscoverylab.com/og-image.png" />

  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#FFFFFF" />

  <link rel="icon" href="/favicon.ico" />

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Inter", "ui-sans-serif", "system-ui", "Segoe UI", "Roboto", "Helvetica Neue", "Arial"]
          },
          colors: {
            ink: "#0A2540",
            text: "#0B1220",
            sub: "#475569",
            surface: "#F6F8FB",
            border: "#E5EAF0",
            accent: "#2563EB",
            success: "#16A34A",
            warn: "#D97706",
            danger: "#DC2626"
          }
        }
      }
    }
  </script>

  <style>
    /* ===== Mobile safe baseline: no horizontal scroll, responsive media ===== */
    html, body { overflow-x: hidden; }
    *, *::before, *::after { box-sizing: border-box; }
    img, svg, video, canvas { max-width: 100%; height: auto; }
    pre, code { word-break: break-word; white-space: pre-wrap; }
    html { scroll-behavior: smooth; }
    body { min-height: 100vh; background: #FFFFFF; color: #0B1220; }

    /* ===== Sticky nav + subtle border ===== */
    .nav-base {
      background: rgba(255,255,255,.92);
      border-bottom: 1px solid #E5EAF0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* ===== Buttons (accent only) ===== */
    .btn-primary {
      background: #2563EB;
      color: #FFFFFF;
      border: 1px solid rgba(37,99,235,.55);
    }
    .btn-primary:hover { background: #1D4ED8; }
    .btn-secondary {
      background: #FFFFFF;
      border: 1px solid #E5EAF0;
      color: #0A2540;
    }
    .btn-secondary:hover { background: #F6F8FB; }

    /* ===== Inputs ===== */
    .field {
      width: 100%;
      background: #FFFFFF;
      border: 1px solid #E5EAF0;
      border-radius: 14px;
      padding: 12px 12px;
      color: #0B1220;
      outline: none;
    }
    .field::placeholder { color: rgba(71,85,105,.75); }
    .field:focus {
      border-color: rgba(37,99,235,.65);
      box-shadow: 0 0 0 4px rgba(37,99,235,.14);
    }
    .label {
      font-size: 12px;
      color: #475569;
      display: block;
      line-height: 16px;
    }

    /* ===== Cookie banner ===== */
    .cookie-banner {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      z-index: 9999;
      background: #0B1220;
      color: #FFFFFF;
      border-top: 1px solid rgba(255,255,255,.12);
      padding: 14px 16px;
    }
    .cookie-banner-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .cookie-banner p {
      margin: 0;
      font-size: 13px;
      line-height: 1.4;
      color: rgba(255,255,255,.88);
    }
    .cookie-actions { display: flex; gap: 10px; align-items: center; }
    .cookie-btn {
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 600;
      font-size: 13px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: #FFF;
      cursor: pointer;
    }
    .cookie-btn:hover { background: rgba(255,255,255,.12); }
    .cookie-btn.primary {
      background: #2563EB;
      border-color: rgba(37,99,235,.55);
    }
    .cookie-btn.primary:hover { background: #1D4ED8; }
    .cookie-link {
      color: rgba(255,255,255,.9);
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    /* ===== Image enlarge modal (sitewide pattern) ===== */
    .img-modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(11,18,32,.72);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }
    .img-modal-panel {
      width: min(1100px, 100%);
      max-height: 86vh;
      background: #FFFFFF;
      border: 1px solid #E5EAF0;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 24px 70px rgba(0,0,0,.25);
      display: flex;
      flex-direction: column;
    }
    .img-modal-topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid #E5EAF0;
      background: #F6F8FB;
    }
    .img-modal-title {
      font-size: 12px;
      color: #475569;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .img-modal-close {
      border-radius: 10px;
      padding: 8px 10px;
      font-weight: 700;
      font-size: 12px;
      border: 1px solid #E5EAF0;
      background: #FFFFFF;
      color: #0A2540;
      cursor: pointer;
    }
    .img-modal-close:hover { background: #F6F8FB; }
    .img-modal-body {
      overflow: auto;
      background: #FFFFFF;
    }
    .img-modal-body img {
      width: 100%;
      height: auto;
      display: block;
    }
  </style>

  <!-- Lightweight Organization JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"My AI Discovery Lab",
    "url":"https://myaidiscoverylab.com/",
    "email":"audit@myaidiscoverylab.com"
  }
  </script>

  <script>
    // ===== Sitewide IDs (keep consistent across ALL pages) =====
    window.__AIDL__ = {
      GA4_ID: "G-7QQ93HP5N6",
      ADSENSE_CLIENT: "ca-pub-7230693944040551"
    };
  </script>
</head>

<body class="font-sans">
  <!-- ===== Cookie Consent Banner (blocks GA4 + AdSense until accepted) ===== -->
  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie consent" style="display:none;">
    <div class="cookie-banner-inner">
      <p>
        We use cookies to measure traffic and support ads. Accept to enable analytics (GA4) and AdSense.
        <a class="cookie-link" href="/privacy.html">Privacy</a>
      </p>
      <div class="cookie-actions">
        <button id="cookieDecline" class="cookie-btn" type="button">Decline</button>
        <button id="cookieAccept" class="cookie-btn primary" type="button">Accept</button>
      </div>
    </div>
  </div>

  <!-- ===== Image Enlarge Modal (sitewide) ===== -->
  <div id="imgModal" class="img-modal-backdrop" aria-hidden="true">
    <div class="img-modal-panel" role="dialog" aria-modal="true" aria-label="Image preview">
      <div class="img-modal-topbar">
        <div id="imgModalTitle" class="img-modal-title">Preview</div>
        <button id="imgModalClose" class="img-modal-close" type="button" aria-label="Close preview">Close</button>
      </div>
      <div class="img-modal-body">
        <img id="imgModalImg" alt="" src="" />
      </div>
    </div>
  </div>

  <!-- ===== Sticky Nav (matches index.html) ===== -->
  <header id="siteNav" class="sticky top-0 z-50 nav-base">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <div class="flex h-16 items-center justify-between">
        <a href="/index.html#top" class="flex items-center gap-3 min-w-0">
          <div class="h-10 w-10 sm:h-11 sm:w-11 rounded-xl border border-border bg-white flex items-center justify-center shrink-0 p-2">
            <img src="./logo-icon.png" alt="My AI Discovery Lab logo" class="h-full w-full object-contain" loading="eager" decoding="async" />
          </div>
          <div class="leading-tight min-w-0">
            <div class="text-sm font-semibold tracking-tight text-ink truncate">My AI Discovery Lab</div>
            <div class="text-[11px] text-sub truncate">Product data infrastructure</div>
          </div>
        </a>

        <!-- Mobile Menu Button -->
        <button id="mobileMenuToggle"
          class="md:hidden inline-flex items-center justify-center rounded-xl p-2 border border-border bg-white"
          aria-label="Open menu">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-ink" fill="none"
               viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>

        <!-- Desktop Nav -->
        <nav class="hidden md:flex items-center gap-6 text-sm text-ink/90">
          <a href="/snapshot.html" class="hover:text-ink transition">Free Snapshot</a>
          <a href="/index.html#method" class="hover:text-ink transition">Method</a>
          <a href="/index.html#offers" class="hover:text-ink transition">Offers</a>
          <a href="/index.html#proof" class="hover:text-ink transition">Proof</a>
          <a href="/index.html#faq" class="hover:text-ink transition">FAQ</a>
          <a href="/insights.html" class="hover:text-ink transition">Insights</a>
        </nav>

        <div class="hidden md:flex items-center gap-3 shrink-0">
          <a href="/snapshot.html"
             class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold btn-secondary">
            Snapshot
          </a>
          <a href="https://buy.stripe.com/bJe14hglS2UQ5BgfrReQM00"
             class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold btn-primary">
            £149 Audit
          </a>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div id="mobileMenu" class="hidden md:hidden pb-4">
        <div class="mt-3 rounded-2xl border border-border bg-white p-4 space-y-3 text-sm text-ink/90">
          <a href="/snapshot.html" class="block hover:text-ink transition">Free Snapshot</a>
          <a href="/index.html#method" class="block hover:text-ink transition">Method</a>
          <a href="/index.html#offers" class="block hover:text-ink transition">Offers</a>
          <a href="/index.html#proof" class="block hover:text-ink transition">Proof</a>
          <a href="/index.html#faq" class="block hover:text-ink transition">FAQ</a>
          <a href="/insights.html" class="block hover:text-ink transition">Insights</a>

          <div class="pt-2 grid grid-cols-1 gap-2">
            <a href="/snapshot.html"
               class="w-full inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold btn-secondary">
              Snapshot
            </a>
            <a href="https://buy.stripe.com/bJe14hglS2UQ5BgfrReQM00"
               class="w-full inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold btn-primary">
              £149 Audit
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main id="top">
    <section class="mx-auto max-w-6xl px-4 sm:px-6 pt-12 sm:pt-16 pb-14">
      <div class="mx-auto max-w-3xl">
        <div class="inline-flex items-center gap-2 rounded-full border border-border bg-surface px-4 py-2">
          <span class="h-2 w-2 rounded-full" style="background:#2563EB;"></span>
          <span class="text-xs text-sub">Audit intake • required to begin</span>
        </div>

        <h1 class="mt-6 text-3xl sm:text-4xl font-semibold tracking-tight text-ink">Audit Intake</h1>
        <p class="mt-3 text-base sm:text-lg text-sub leading-relaxed">
          Provide the details below so we can audit your live product JSON + JSON-LD and deliver your implementation blueprint.
        </p>

        <div class="mt-8 rounded-2xl border border-border bg-surface p-5">
          <div class="text-sm font-semibold text-ink">What happens after you submit</div>
          <ul class="mt-3 space-y-2 text-sm text-sub">
            <li class="flex gap-2"><span class="mt-1 h-2 w-2 rounded-full" style="background:#2563EB;"></span><span>We confirm access and identify a representative PDP + catalogue patterns.</span></li>
            <li class="flex gap-2"><span class="mt-1 h-2 w-2 rounded-full" style="background:#2563EB;"></span><span>We extract your current JSON-LD + app/theme injections.</span></li>
            <li class="flex gap-2"><span class="mt-1 h-2 w-2 rounded-full" style="background:#2563EB;"></span><span>You receive an issue register + blueprint to fix structural visibility.</span></li>
          </ul>
        </div>

        <div class="mt-8 rounded-2xl border border-border bg-white p-6 sm:p-8">
          <form class="space-y-5" action="https://formspree.io/f/xdaldprq" method="POST">
            <!-- After submission redirect (KEEP as-is from your file) -->
            <input type="hidden" name="_next" value="https://myaidiscoverylab.com/intake-confirmed.html" />
            <input type="hidden" name="_subject" value="New AI Discovery Audit Intake" />
            <input type="hidden" name="submission_source" value="intake_form" />
            <input type="hidden" name="service_type" value="ai_discovery_audit" />
            <input type="hidden" name="lead_stage" id="lead_stage" value="lead" />
            <input type="hidden" name="offer_type" id="offer_type" value="snapshot" />
            <input type="hidden" name="source_page" value="/intake.html" />
            <input type="hidden" name="utm_source" value="" />
            <input type="hidden" name="utm_campaign" value="" />
            <input type="hidden" name="utm_medium" value="" />
            <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" />
            <input type="hidden" id="payment_verified" name="payment_verified" value="false" />

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="label" for="fullName">Full Name <span class="text-danger">*</span></label>
                <input class="field mt-2" id="fullName" name="fullName" type="text" required autocomplete="name" />
              </div>
              <div>
                <label class="label" for="email">Email <span class="text-danger">*</span></label>
                <input class="field mt-2" id="email" name="email" type="email" required autocomplete="email" />
              </div>
            </div>

            <div>
              <label class="label" for="websiteUrl">Website URL <span class="text-danger">*</span></label>
              <input class="field mt-2" id="websiteUrl" name="websiteUrl" type="url" required placeholder="https://yourstore.com" />
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="label" for="platform">Platform</label>
                <select class="field mt-2" id="platform" name="platform">
                  <option value="Shopify">Shopify</option>
                  <option value="Shopify Plus">Shopify Plus</option>
                  <option value="WooCommerce">WooCommerce</option>
                  <option value="Headless (Hydrogen / Next / Custom)">Headless (Hydrogen / Next / Custom)</option>
                  <option value="Magento">Magento</option>
                  <option value="BigCommerce">BigCommerce</option>
                  <option value="Custom Build">Custom Build</option>
                  <option value="Not sure">Not sure</option>
                </select>
              </div>
              <div>
                <label class="label" for="productUrl">Representative Product URL <span class="text-danger">*</span></label>
                <input class="field mt-2" id="productUrl" name="productUrl" type="url" required placeholder="https://yourstore.com/products/example" />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="label" for="monthlyRevenue">Estimated Monthly Revenue (optional)</label>
                <select class="field mt-2" id="monthlyRevenue" name="monthlyRevenue">
                  <option value="Pre-revenue">Pre-revenue</option>
                  <option value="£0–£10K">£0–£10K</option>
                  <option value="£10K–£50K">£10K–£50K</option>
                  <option value="£50K–£250K">£50K–£250K</option>
                  <option value="£250K+">£250K+</option>
                </select>
              </div>

              <div>
                <label class="label" for="primaryMarket">Primary Market</label>
                <select class="field mt-2" id="primaryMarket" name="primaryMarket">
                  <option value="UK">UK</option>
                  <option value="US">US</option>
                  <option value="EU">EU</option>
                  <option value="International">International</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="label" for="passwordProtected">Password protected? <span class="text-danger">*</span></label>
                <select class="field mt-2" id="passwordProtected" name="passwordProtected" required>
                  <option value="" disabled selected>Select one</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div>
                <label class="label" for="liveProductsCount">Approx. live products <span class="text-danger">*</span></label>
                <select class="field mt-2" id="liveProductsCount" name="liveProductsCount" required>
                  <option value="" disabled selected>Select one</option>
                  <option value="1–10">1–10</option>
                  <option value="10–50">10–50</option>
                  <option value="50–200">50–200</option>
                  <option value="200+">200+</option>
                </select>
              </div>
            </div>

            <div>
              <label class="label" for="notes">Additional Notes</label>
              <textarea class="field mt-2 min-h-[120px]" id="notes" name="notes" placeholder="Anything we should know (collections to prioritise, variant complexity, international pricing, etc.)"></textarea>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 pt-2">
              <button type="submit"
                class="w-full inline-flex items-center justify-center rounded-xl px-6 py-3 font-semibold btn-primary">
                Submit Intake
              </button>

              <a href="/index.html"
                class="w-full inline-flex items-center justify-center rounded-xl px-6 py-3 font-semibold btn-secondary">
                Back to site
              </a>
            </div>

            <div class="mt-4 text-xs text-sub break-words text-center">
              Questions? <a class="underline text-accent" href="mailto:audit@myaidiscoverylab.com">audit@myaidiscoverylab.com</a>
              <span class="mx-2">•</span>
              One-time audit. No contract.
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Footer (matches index.html) -->
    <footer class="border-t border-border bg-white">
      <div class="mx-auto max-w-6xl px-4 sm:px-6 py-10">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-8">
          <div class="flex items-start gap-4 min-w-0">
            <div class="h-12 w-12 rounded-xl border border-border bg-white flex items-center justify-center shrink-0 p-2">
              <img src="./logo-icon.png" alt="My AI Discovery Lab logo" class="h-full w-full object-contain" />
            </div>
            <div class="text-sm min-w-0">
              <div class="font-semibold text-ink break-words">My AI Discovery Lab</div>
              <div class="mt-1 text-sub break-words">Machine-readable commerce infrastructure.</div>
              <div class="mt-2 text-sub break-words">
                <a class="underline text-accent" href="mailto:audit@myaidiscoverylab.com">audit@myaidiscoverylab.com</a>
              </div>
            </div>
          </div>

          <div class="flex flex-col md:items-end gap-3">
            <div class="flex flex-wrap items-center gap-4 text-sm text-sub">
              <a href="/privacy.html" class="hover:text-ink transition">Privacy</a>
              <a href="/terms.html" class="hover:text-ink transition">Terms</a>
              <a href="/snapshot.html" class="hover:text-ink transition">Snapshot</a>
              <a href="/insights.html" class="hover:text-ink transition">Insights</a>
            </div>
            <div class="text-xs text-sub">© <span id="year"></span> My AI Discovery Lab. All rights reserved.</div>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <script>
    // Current year
    document.getElementById("year").textContent = new Date().getFullYear();

    // ===== Mobile menu toggle + close on link click =====
    const toggle = document.getElementById("mobileMenuToggle");
    const menu = document.getElementById("mobileMenu");

    if (toggle && menu) {
      toggle.addEventListener("click", () => menu.classList.toggle("hidden"));
    }
    document.querySelectorAll('#mobileMenu a').forEach(a => {
      a.addEventListener('click', () => menu?.classList.add('hidden'));
    });
  </script>

  <!-- ===== Offer tagging (NEW) ===== -->
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const offer = (params.get("offer") || "snapshot").toLowerCase();
      const offerType = (offer === "audit") ? "audit" : "snapshot";

      const offerEl = document.getElementById("offer_type");
      if (offerEl) offerEl.value = offerType;

      const stageEl = document.getElementById("lead_stage");
      if (stageEl) stageEl.value = (offerType === "audit") ? "paid_intake" : "lead";
    })();
  </script>

  <!-- ===== Payment flag setter (KEEP) ===== -->
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const paid = params.get("paid") === "1";
      const preview = params.get("preview") === "1";

      if (paid) {
        try { localStorage.setItem("myaidl_paid_intake", "1"); } catch (e) {}
      }

      const pv = document.getElementById("payment_verified");
      if (pv && (paid || preview)) pv.value = "true";
    })();
  </script>

  <!-- ===== URL normaliser + validation (KEEP) ===== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector("form");
      const websiteField = document.getElementById("websiteUrl");
      const productField = document.getElementById("productUrl");

      if (!form || !websiteField || !productField) return;

      function normalizeUrl(input) {
        let value = (input.value || "").trim();
        if (value && !/^https?:\/\//i.test(value)) value = "https://" + value;
        input.value = value;
      }

      function isValidUrl(value) {
        try {
          const u = new URL(value);
          return !!u.hostname && u.hostname.includes(".");
        } catch {
          return false;
        }
      }

      websiteField.addEventListener("blur", () => normalizeUrl(websiteField));
      productField.addEventListener("blur", () => normalizeUrl(productField));

      form.addEventListener("submit", (e) => {
        normalizeUrl(websiteField);
        normalizeUrl(productField);

        const websiteValue = websiteField.value.trim();
        const productValue = productField.value.trim();

        if (!isValidUrl(websiteValue) || !isValidUrl(productValue)) {
          e.preventDefault();
          alert("Please enter valid full URLs (e.g. https://example.com).");
          return;
        }

        if (websiteValue.length < 10 || productValue.length < 10) {
          e.preventDefault();
          alert("URL looks incomplete. Please check and try again.");
        }
      });
    });
  </script>

  <!-- ===== Image Enlarge (sitewide) ===== -->
  <script>
    (function () {
      const modal = document.getElementById("imgModal");
      const img = document.getElementById("imgModalImg");
      const title = document.getElementById("imgModalTitle");
      const closeBtn = document.getElementById("imgModalClose");

      if (!modal || !img || !closeBtn) return;

      function openModal(src, altText) {
        img.src = src;
        img.alt = altText || "";
        title.textContent = altText || "Preview";
        modal.style.display = "flex";
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        modal.style.display = "none";
        modal.setAttribute("aria-hidden", "true");
        img.src = "";
        document.body.style.overflow = "";
      }

      closeBtn.addEventListener("click", closeModal);
      modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

      // Any image with data-enlarge="true" will open in modal
      document.querySelectorAll('img[data-enlarge="true"]').forEach((el) => {
        el.style.cursor = "zoom-in";
        el.addEventListener("click", () => openModal(el.currentSrc || el.src, el.alt));
      });
    })();
  </script>

  <!-- ===== Consent + Analytics Loader (GA4 + AdSense gated) ===== -->
  <script>
    (function () {
      const CONSENT_KEY = "aidl_cookie_consent_v1";
      const banner = document.getElementById("cookieBanner");
      const acceptBtn = document.getElementById("cookieAccept");
      const declineBtn = document.getElementById("cookieDecline");

      function hasConsent() {
        return localStorage.getItem(CONSENT_KEY) === "accepted";
      }
      function setConsent(value) {
        localStorage.setItem(CONSENT_KEY, value);
      }
      function loadScriptOnce(id, src) {
        if (document.getElementById(id)) return;
        const s = document.createElement("script");
        s.id = id;
        s.async = true;
        s.src = src;
        document.head.appendChild(s);
      }

      function enableGA4() {
        const GA4_ID = (window.__AIDL__ && window.__AIDL__.GA4_ID) || "";
        if (!GA4_ID) return;

        loadScriptOnce("ga4-gtag", "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(GA4_ID));

        window.dataLayer = window.dataLayer || [];
        function gtag(){ window.dataLayer.push(arguments); }
        window.gtag = window.gtag || gtag;

        gtag("js", new Date());
        gtag("config", GA4_ID, { anonymize_ip: true });

        // Fire intake view event after GA is enabled (once)
        try {
          const firedKey = "aidl_intake_view_fired_v1";
          if (!sessionStorage.getItem(firedKey)) {
            sessionStorage.setItem(firedKey, "1");
            gtag("event", "intake_form_view", {
              page_location: window.location.href,
              page_path: window.location.pathname
            });
          }
        } catch (e) {}
      }

      function enableAdSense() {
        const client = (window.__AIDL__ && window.__AIDL__.ADSENSE_CLIENT) || "";
        if (!client) return;

        loadScriptOnce(
          "adsense-auto",
          "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=" + encodeURIComponent(client)
        );
      }

      function enableTracking() {
        enableGA4();
        enableAdSense();
      }

      const prior = localStorage.getItem(CONSENT_KEY);
      if (hasConsent()) {
        enableTracking();
      } else {
        if (banner && !prior) banner.style.display = "block";
      }

      if (acceptBtn) {
        acceptBtn.addEventListener("click", function () {
          setConsent("accepted");
          if (banner) banner.style.display = "none";
          enableTracking();
        });
      }

      if (declineBtn) {
        declineBtn.addEventListener("click", function () {
          setConsent("declined");
          if (banner) banner.style.display = "none";
        });
      }
    })();
  </script>
</body>
</html>